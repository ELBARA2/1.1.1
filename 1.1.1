function activeUser() {
    const userName = document.getElementById('username').value.trim();
    const activeUserElement = document.getElementById('activeUser');
    const currentActiveUser = activeUserElement.innerHTML;
    
    // Only proceed if username is not empty
    if (!userName) return;
    
    if (newUser === 0) {
        db.collection("chat").add({
            text: `${userName} joined the chat`,
            user: '',
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
            console.log("User joined message sent");
        }).catch((error) => {
            console.error("Error sending user joined message:", error);
        });
        
        // Set the initial user
        activeUserElement.innerHTML = userName;
        newUser++;
    }
    else if (newUser > 0 && userName !== currentActiveUser && currentActiveUser !== "5") {  // Added check to ignore initial "5"
        db.collection("chat").add({
            text: `${currentActiveUser} changed name to ${userName}`,
            user: '',
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
            console.log("User name change message sent");
        }).catch((error) => {
            console.error("Error sending user name change message:", error);
        });
        
        // Update the user name
        activeUserElement.innerHTML = userName;
    }
    else if (userName !== currentActiveUser && currentActiveUser === "5") {
        // First time setting username (from initial "5")
        activeUserElement.innerHTML = userName;
        newUser++;
    }
}
